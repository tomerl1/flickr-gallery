!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(t,e){},function(t,e,s){"use strict";e.a=class{constructor(t){if(!t)throw new Error("This doesn't work with an empty selector...");this.elRoot=document.querySelector(t),this.elValue=document.createElement("div"),this.elValue.className="progressbar-value",this.elValue.style.transform="translate(-100%, 0)",this.elRoot.appendChild(this.elValue),this.percent=0}setValue(t){this.percent=t,this.updateUI()}updateUI(){this.elValue.style.transform=`translate(${this.percent-100}%, 0)`}reset(){this.elValue.style.display="none",setTimeout(()=>{this.percent=0,this.updateUI(),this.elValue.style.display="block"},5)}}},function(t,e,s){s(3),t.exports=s(0)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(0),a=(s.n(i),s(4)),r=s(1);const n=new a.a(".flickr-gallery"),o=new r.a(".progressbar");n.elRoot.addEventListener("update-progress",function(t){o.setValue(t.detail)}),n.elRoot.addEventListener("reset-progress",function(t){o.reset()}),console.log("main.js loaded.")},function(t,e,s){"use strict";var i=s(5);const a="https://api.flickr.com/services/feeds/photos_public.gne?format=json";function r(t){this.setData(t)}e.a=class{constructor(t){if(!t)throw new Error("The selector can not be empty");this.elRoot=document.querySelector(t),this.arrImages=[],this.history=[],window.addEventListener("resize",this.displayImages.bind(this)),window.addEventListener("hashchange",this.handleHashChange.bind(this)),this.registerFlickrCallback(),this.createFeedRequest(),this.detectTouchDevice()}detectTouchDevice(){let t=!0;try{document.createEvent("TouchEvent")}catch(e){t=!1}t&&this.elRoot.classList.add("touch")}handleHashChange(){const t=window.location.hash.substr(1);t&&t.length>0?(this.saveState(),this.createFeedRequest(`&id=${t}`)):this.loadFromState()}saveState(){this.history.push({data:JSON.parse(JSON.stringify(this.data))})}loadFromState(){const t=this.history.pop();this.setData(t.data)}registerFlickrCallback(){const t=this;if(window.jsonFlickrFeed){const e=window.jsonFlickrFeed;window.jsonFlickrFeed=function(){e.apply(window,arguments),r.apply(t,arguments)}}else window.jsonFlickrFeed=function(e){r.apply(t,arguments)}}createFeedRequest(t){t=t||"";const e=document.createElement("script");e.src=a+t,document.body.appendChild(e),this.script=e;const s=new CustomEvent("reset-progress");this.elRoot.dispatchEvent(s)}setData(t){t?(this.data=t,this.script&&(document.body.removeChild(this.script),this.script=void 0),this.preloadImages(this.data.items)):console.log("oops.. no data")}preloadImages(t){this.arrImages=[],this.preload={count:t.length,current:0,percent:function(){return Math.round(this.current/this.count*100)},isDone:function(){return this.current===this.count}},t.forEach(t=>{this.preloadImage(t)})}preloadImage(t){const e=t.media.m,s=new Image;this.arrImages.push(s),s.dataset.flickr=JSON.stringify(t),s.onload=(t=>{this.preload.current++;const e=new CustomEvent("update-progress",{detail:this.preload.percent()});this.elRoot.dispatchEvent(e),this.preload.isDone()&&setTimeout(()=>{this.displayImages()},50)}),s.src=e}getImageHtml(t,e){const s=JSON.parse(t.dataset.flickr),i=new Date(s.date_taken),a=`${i.getDate().toString().padStart(2,"0")}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getFullYear()}`,r=s.author.replace(/(.*)"(.*)"(.*)/,"$2");return`<div class="image-wrapper" style="height:${e.height}px;">\n            <a class="gallery-image" style="width:${e.width}px;height:${e.height}px;" target="_blank" title="${s.title}" href="${s.link}">\n                <img src="${t.src}" alt="${s.title}" />\n            </a>\n            <div class="image-author">\n                <div class="image-author-inner ellipsis">\n                    by <a href="#${s.author_id}" title="@${r} | ${s.title}" data-author-id="${s.author_id}">${r}</a>\n                </div>\n            </div>\n            <div class="image-date"><span class="image-date-inner ellipsis">${a}</span></div>\n        </div>`}displayImages(){this.elRoot.innerHTML="";const t=this.arrImages,e=this.elRoot.offsetWidth-40;let s=0,i=[],a=0;t.forEach((t,e)=>{const a=this.getSize(t);200!==a.y&&(a.x=Math.floor(a.x*(200/a.y))),s+=a.x,i.push(a.x)});const r=Math.ceil(s/e),n=s/r;console.log("rows count",r);const o=this.generateRows(t,i,n);let l=0;for(let t=0;t<o.length;t++){const s=o[t];o.length;let i=e;l=t+1,a=-0;let r=i/s.width,n=s.images.length;const h=Math.min(Math.floor(200*r),500);r=h/200;const c=this.createDomRow(h+0);this.elRoot.appendChild(c);let{imagesHtml:d,rowWidth:u}=this.generateImagesHtml(s,r,0,a,h);this.writeImagesHtml(c,d)||this.adjustToFill(u,i,c,n)}}generateRows(t,e,s){const i=t.length;let a=[],r=0,n=0;for(;n<i;){const o={width:0,images:[]};let l=0;for(;r+e[n+l]/2<=s*(a.length+1)&&n+l<i;)r+=e[n+l],o.width+=e[n+l],o.images.push({width:e[n+l],image:t[n+l]}),l++;n+=l,a.push(o)}return a}generateImagesHtml(t,e,s,i,a){let r=[];for(let l=0;l<t.images.length;l++){var n=t.images[l].image,o=Math.floor(t.images[l].width*e);i+=o+s,r.push(this.getImageHtml(n,{width:o,height:a}))}return{imagesHtml:r.join(""),rowWidth:i}}createDomRow(t){const e=document.createElement("div");return e.className="gallery-row",e.style.height=t+"px",e}writeImagesHtml(t,e){let s=!1;return""===e&&(t.parentElement.removeChild(t),s=!0),t.innerHTML=e,s}adjustToFill(t,e,s,i){let a=0;for(;t<e;){const e=s.querySelector(".image-wrapper:nth-child("+(a+1)+") .gallery-image");e.style.width=e.offsetWidth+1+"px",a=(a+1)%i,t++}for(a=0;t>e;){const e=s.querySelector(".image-wrapper:nth-child("+(a+1)+") .gallery-image");e.style.width=e.offsetWidth-1+"px",a=(a+1)%i,t--}}getSize(t){return new i.a(t.naturalWidth,t.naturalHeight)}}},function(t,e,s){"use strict";e.a=class{constructor(t,e){this.x=t,this.y=e}}}]);
//# sourceMappingURL=main.bundle.js.map